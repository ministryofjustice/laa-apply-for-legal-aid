<%= form_with(model: model, url: url, method: :patch, local: true) do |form| %>

  <%= govuk_form_group show_error_if: (@form.errors.present? && !@form.any_checkbox_checked?) do %>
    <fieldset class="govuk-fieldset" aria-describedby="select-all-that-apply-hint">
      <%= govuk_fieldset_header page_title %>
      <h2 class="govuk-heading-m"><%= t('generic.select_all_that_apply') %></h2>

      <% if @form.errors.any? %>
        <span class="govuk-error-message">
          <% @form.errors.messages.values.each do |msg| %>
             <% msg.each do  |m| %>
               <%= m %>
             <%end %>
           <% end %>
        </span>
      <% end %>
      
      <div class="govuk-checkboxes" data-module="govuk-checkboxes">
        <div class="deselect-group" data-deselect-ctrl="[name='other_assets_declaration[none_selected]']">
          <%= render partial: '/shared/forms/revealing_checkbox/attribute',
                     collection: Citizens::OtherAssetsForm::VALUABLE_ITEMS_VALUE_ATTRIBUTE,
                     locals: { model: model, form: form } %>
          <%= render partial: '/shared/forms/other_assets/second_home_conditional_checkbox', locals: { model: model, form: form } %>
          <%= render partial: '/shared/forms/revealing_checkbox/attribute',
                     collection: Citizens::OtherAssetsForm::SINGLE_VALUE_ATTRIBUTES,
                     locals: { model: model, form: form } %>
        </div>
      </div>

      <div class="govuk-radios__divider tickbox_divider"><%= or_break %></div>

      <div class="govuk-checkboxes">
        <div class="govuk-checkboxes__item">
          <%= form.check_box :none_selected, { class: 'govuk-checkboxes__input' }, 'true', @form.none_selected %>
          <%= form.label :none_selected, none_selected, class: 'govuk-label govuk-checkboxes__label' %>
        </div>
      </div>
    </fieldset>
  <% end %>

  <%= next_action_buttons(
        show_draft: local_assigns.key?(:show_draft) ? show_draft : false,
        form: form
      ) %>
<% end %>
