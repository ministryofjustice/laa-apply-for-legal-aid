<h2 class="govuk-heading-l"><%= t(".case-details-heading") %></h2>

<% if @legal_aid_application.latest_incident %>
  <section class="print-no-break">
    <%= check_answer_change_link(
          name: :incident_details,
          url: providers_legal_aid_application_date_client_told_incident_path(@legal_aid_application),
          question: t(".latest-incident-heading"),
          read_only:,
        ) %>

    <dl class="govuk-summary-list govuk-!-margin-bottom-2">
      <%= check_answer_no_link(
            name: :notification_of_latest_incident,
            question: t(".items.notification_of_latest_incident"),
            answer: incident&.told_on,
            read_only:,
          ) %>

      <%= check_answer_no_link(
            name: :date_of_latest_incident,
            question: t(".items.date_of_latest_incident"),
            answer: incident&.occurred_on,
            read_only:,
          ) %>
    </dl>
  </section>
<% end %>

<section class="print-no-break govuk-!-padding-top-6">
  <%= check_answer_change_link(
        name: :opponents,
        url: providers_legal_aid_application_has_other_opponent_path(@legal_aid_application),
        question: t(".opponent-heading"),
        read_only:,
      ) %>
  <% opponents.order(:created_at).each_with_index do |opponent, i| %>
    <dl class="govuk-summary-list govuk-!-margin-bottom-2 ">
      <%= check_answer_no_link(
            name: "opponent_#{i + 1}".to_sym,
            question: "#{t('.items.opponent')} #{i + 1}",
            answer: opponent.full_name,
            no_border: false,
            read_only:,
          ) %>
    </dl>
  <% end %>
</section>

  <dl class="govuk-summary-list govuk-!-margin-bottom-2">
    <%= check_answer_link(
          name: :understands_terms_of_court_order,
          question: t(".items.understands_terms_of_court_order"),
          url: providers_legal_aid_application_opponents_mental_capacity_path(@legal_aid_application),
          answer: yes_no(parties_mental_capacity.understands_terms_of_court_order),
          no_border: !parties_mental_capacity.understands_terms_of_court_order,
          read_only:,
        ) %>
  </dl>
  <div class='govuk-body'><%= parties_mental_capacity.understands_terms_of_court_order_details %></div>

  <%= render "shared/check_answers/section_break" unless parties_mental_capacity.understands_terms_of_court_order %>

  <% if task_list_includes?(@legal_aid_application, :domestic_abuse_summary) %>
    <dl class="govuk-summary-list govuk-!-margin-bottom-2">
      <%= check_answer_link(
            name: :warning_letter_sent,
            question: t(".items.warning_letter_sent"),
            url: providers_legal_aid_application_domestic_abuse_summary_path(@legal_aid_application),
            answer: yes_no(domestic_abuse_summary.warning_letter_sent),
            no_border: !domestic_abuse_summary.warning_letter_sent,
            read_only:,
          ) %>
    </dl>
    <div class='govuk-body'><%= domestic_abuse_summary.warning_letter_sent_details %></div>

    <%= render "shared/check_answers/section_break" unless domestic_abuse_summary.warning_letter_sent %>

    <dl class="govuk-summary-list govuk-!-margin-bottom-2">
      <%= check_answer_link(
            name: :police_notified,
            question: t(".items.police_notified"),
            url: providers_legal_aid_application_domestic_abuse_summary_path(@legal_aid_application),
            answer: yes_no(domestic_abuse_summary.police_notified),
            no_border: true,
            read_only:,
          ) %>
    </dl>
    <div class='govuk-body'><%= domestic_abuse_summary.police_notified_details %></div>

    <%= render "shared/check_answers/section_break" %>

    <dl class="govuk-summary-list govuk-!-margin-bottom-2">
      <%= check_answer_link(
            name: :bail_conditions_set,
            question: t(".items.bail_conditions_set"),
            url: providers_legal_aid_application_domestic_abuse_summary_path(@legal_aid_application),
            answer: yes_no(domestic_abuse_summary.bail_conditions_set),
            no_border: domestic_abuse_summary.bail_conditions_set,
            read_only:,
          ) %>
    </dl>
    <div class='govuk-body'><%= domestic_abuse_summary.bail_conditions_set_details %></div>

    <%= render "shared/check_answers/section_break" if domestic_abuse_summary.bail_conditions_set %>
  <% end %>
</section>
<div class="govuk-!-padding-bottom-6"></div>
<section class="print-no-break">
  <dl class="govuk-summary-list govuk-!-margin-bottom-2 print-remove-border">
    <%= check_answer_link(
          name: :statement_of_case,
          url: providers_legal_aid_application_statement_of_case_path(@legal_aid_application),
          answer: attachments_with_size(statement_of_case&.original_attachments),
          question: t(".statement-of-case-heading"),
          read_only:,
          no_border: true,
        ) %>
  </dl>
  <div class="govuk-body"><%= statement_of_case&.statement %></div>
  <%= render "shared/check_answers/section_break" if statement_of_case&.statement %>
</section>

<% if @legal_aid_application.allegation %>
  <div class="govuk-!-padding-bottom-6"></div>
  <section class="print-no-break">
    <h2 class="govuk-heading-m"><%= t(".client_denial_of_allegation_heading") %></h2>

    <dl class="govuk-summary-list govuk-!-margin-bottom-2">
      <%= check_answer_link(
            name: :allegation_denies_all,
            url: providers_legal_aid_application_client_denial_of_allegation_path(@legal_aid_application),
            question: t(".items.allegation_denies_all"),
            answer: yes_no(allegation.denies_all),
            no_border: true,
            read_only:,
          ) %>
    </dl>
    <div class='govuk-body'><%= allegation.additional_information %></div>
    <%= render "shared/check_answers/section_break" if allegation.additional_information %>
  </section>
<% end %>

<% if @legal_aid_application.undertaking %>
  <div class="govuk-!-padding-bottom-6"></div>
  <section class="print-no-break">
    <h2 class="govuk-heading-m"><%= t(".client_offer_of_undertakings_heading") %></h2>

    <dl class="govuk-summary-list govuk-!-margin-bottom-2">
      <%= check_answer_link(
            name: :undertaking_offered,
            url: providers_legal_aid_application_client_offered_undertakings_path(@legal_aid_application),
            question: t(".items.undertaking_offered"),
            answer: yes_no(undertaking.offered),
            no_border: true,
            read_only:,
          ) %>
    </dl>
    <div class='govuk-body'><%= undertaking.additional_information %></div>
    <%= render "shared/check_answers/section_break" if undertaking.additional_information %>
  </section>
<% end %>

<% if @legal_aid_application.urgency %>
  <div class="govuk-!-padding-bottom-6"></div>
  <section class="print-no-break">
    <%= check_answer_change_link(
          name: :nature_of_urgency_heading,
          url: providers_legal_aid_application_nature_of_urgencies_path(@legal_aid_application),
          question: t(".nature_of_urgency_heading"),
          read_only:,
        ) %>

    <dl class="govuk-summary-list govuk-!-margin-bottom-2">
      <%= check_answer_no_link(
            name: :nature_of_urgency,
            question: t(".items.nature_of_urgency"),
            answer: urgency.nature_of_urgency,
            read_only:,
          ) %>
    </dl>

    <dl class="govuk-summary-list govuk-!-margin-bottom-2">
      <%= check_answer_no_link(
            name: :hearing_date_set,
            question: t(".items.hearing_date_set"),
            answer: sanitize("#{yes_no(urgency.hearing_date_set)}<br>#{urgency.hearing_date}#{urgency.additional_information}"),
            read_only:,
          ) %>
    </dl>
  </section>
<% end %>

<% if @legal_aid_application.section_8_proceedings? %>
  <section class="print-no-break govuk-!-padding-top-6">
    <%= check_answer_change_link(
          name: :involved_children,
          url: providers_legal_aid_application_has_other_involved_children_path(@legal_aid_application),
          question: t(".involved-children-heading"),
          read_only:,
        ) %>
    <% @legal_aid_application.involved_children.each_with_index do |child, i| %>
      <dl class="govuk-summary-list govuk-!-margin-bottom-2 ">
        <%= check_answer_no_link(
              name: "involved_child_#{i + 1}".to_sym,
              question: "#{t('.items.child')} #{i + 1}",
              answer: "#{child.full_name} born on #{child.date_of_birth.strftime('%e %B %Y')}",
              no_border: false,
              read_only:,
            ) %>
      </dl>
    <% end %>
    <h2 class="govuk-heading-m govuk-!-padding-top-6"><%= t ".laspo.heading" %></h2>
    <dl class="govuk-summary-list govuk-!-margin-bottom-9">
      <%= check_answer_link(
            name: :in_scope_of_laspo,
            url: providers_legal_aid_application_in_scope_of_laspo_path(@legal_aid_application),
            question: t(".laspo.question"),
            answer: yes_no(@legal_aid_application.in_scope_of_laspo),
            read_only:,
          ) %>
    </dl>
  </section>
<% end %>

<% if @legal_aid_application.matter_opposition %>
  <section class="print-no-break govuk-!-padding-top-6">
    <%= check_answer_change_link(
          name: :matter_opposed_reason_heading,
          url: providers_legal_aid_application_matter_opposed_reason_path(@legal_aid_application),
          question: t(".matter_opposed_reason_heading"),
          read_only:,
        ) %>

    <dl class="govuk-summary-list govuk-!-margin-bottom-2">
      <%= check_answer_no_link(
            name: :matter_opposed_reason,
            question: t(".items.matter_opposed_reason"),
            answer: @legal_aid_application.matter_opposition.reason,
            read_only:,
          ) %>
    </dl>
  </section>
<% end %>

<%# TODO: The gateway evidence may not exist for an application transitioning to MP feature %>
<% if gateway_evidence %>
  <div class="govuk-!-padding-bottom-6"></div>

  <section class="print-no-break">
    <h2 class="govuk-heading-m">
      <%= t ".gateway-evidence-heading" %>
    </h2>
    <dl class="govuk-summary-list govuk-!-margin-bottom-2 print-remove-border">
    <%= check_answer_link(
          name: :gateway_evidence,
          url: providers_legal_aid_application_gateway_evidence_path(@legal_aid_application),
          question: t(".items.gateway_evidence"),
          answer: attachments_with_size(gateway_evidence&.original_attachments),
          read_only:,
        ) %>
    </dl>
  </section>
<% end %>

<% @legal_aid_application.proceedings.each do |proceeding| %>
  <div class="govuk-!-padding-bottom-6"></div>
  <section class="print-no-break">
    <h2 class="govuk-heading-l"><%= proceeding.meaning %></h2>

    <dl class="govuk-summary-list govuk-!-margin-bottom-2">
      <%= check_answer_link(
            name: "#{proceeding.id}_success_likely".to_sym,
            url: providers_merits_task_list_chances_of_success_index_path(proceeding),
            question: t(".items.prospects_of_success"),
            answer: yes_no(proceeding.chances_of_success.success_likely),
            read_only:,
          ) %>

      <% unless proceeding.chances_of_success.success_likely? %>
        <%= check_answer_link(
              name: "#{proceeding.id}_success_prospect".to_sym,
              url: providers_merits_task_list_success_prospects_path(proceeding),
              question: t(".items.success_prospect"),
              answer: t("shared.forms.success_prospect.#{proceeding.chances_of_success.success_prospect}"),
              read_only:,
            ) %>
      <% end %>
    </dl>

    <% if proceeding.chances_of_success.success_prospect_details %>
      <div class='govuk-body'><%= proceeding.chances_of_success.success_prospect_details %></div>
      <hr>
    <% end %>

    <% if proceeding.attempts_to_settle %>
      <dl class="govuk-summary-list govuk-!-margin-bottom-2">
        <%= check_answer_link(
              name: "#{proceeding.id}_attempts_to_settle".to_sym,
              url: providers_merits_task_list_attempts_to_settle_path(proceeding),
              question: t(".items.attempts_to_settle"),
              answer: proceeding.attempts_to_settle.attempts_made,
              read_only:,
            ) %>
      </dl>
    <% end %>
    <% if proceeding.section8? %>
      <dl class="govuk-summary-list govuk-!-margin-bottom-2">
        <%= check_answer_link(
              name: "#{proceeding.id}_linked_children".to_sym,
              url: providers_merits_task_list_linked_children_path(proceeding),
              question: t(".items.linked_children"),
              answer: linked_children_names(proceeding),
              read_only:,
            ) %>
      </dl>
    <% end %>
    <% if proceeding.specific_issue %>
      <dl class="govuk-summary-list govuk-!-margin-bottom-2">
        <%= check_answer_link(
              name: "#{proceeding.id}_specific_issue".to_sym,
              url: providers_merits_task_list_specific_issue_path(proceeding),
              question: t(".items.specific_issue"),
              answer: proceeding.specific_issue.details,
              read_only:,
            ) %>
      </dl>
    <% end %>
    <% if proceeding.prohibited_steps %>
      <dl class="govuk-summary-list govuk-!-margin-bottom-0 print-remove-border">
        <%= check_answer_link(
              name: "#{proceeding.id}_prohibited_steps".to_sym,
              url: providers_merits_task_list_prohibited_steps_path(proceeding),
              question: t(".items.prohibited_steps"),
              answer: yes_no(proceeding.prohibited_steps.uk_removal),
              read_only:,
              no_border: true,
            ) %>
      </dl>
      <% unless proceeding.prohibited_steps.uk_removal %>
        <div class="govuk-body"><%= proceeding.prohibited_steps.details %></div>
      <% end %>
      <%= render "shared/check_answers/section_break" %>
    <% end %>
    <% if proceeding.vary_order %>
      <dl class="govuk-summary-list govuk-!-margin-bottom-2">
        <%= check_answer_link(
              name: "#{proceeding.id}_vary_order".to_sym,
              url: providers_merits_task_list_vary_order_path(proceeding),
              question: t(".items.vary_order"),
              answer: proceeding.vary_order.details,
              read_only:,
            ) %>
      </dl>
    <% end %>
    <% if proceeding.opponents_application %>
      <dl class="govuk-summary-list govuk-!-margin-bottom-2 govuk-!-margin-top-2">
        <%= check_answer_link(
              name: "#{proceeding.id}_opponents_application".to_sym,
              url: providers_merits_task_list_opponents_application_path(proceeding),
              question: t(".items.opponents_application_question"),
              answer: yes_no(proceeding.opponents_application.has_opponents_application),
              read_only:,
            ) %>
        <% if proceeding.opponents_application.reason_for_applying %>
          <%= check_answer_link(
                name: "#{proceeding.id}_opponents_application".to_sym,
                url: providers_merits_task_list_opponents_application_path(proceeding),
                question: t(".items.opponents_application_reason"),
                answer: proceeding.opponents_application.reason_for_applying,
                read_only:,
              ) %>
        <% end %>
      </dl>
    <% end %>
  </section>
<% end %>

<% if @legal_aid_application.uploaded_evidence_collection %>
  <div class="govuk-!-padding-bottom-6"></div>
  <section class="print-no-break">
    <%= check_answer_change_link(
          name: :supporting_evidence,
          url: providers_legal_aid_application_uploaded_evidence_collection_path(@legal_aid_application),
          question: t(".evidence_upload_heading"),
          read_only:,
        ) %>

    <dl class="govuk-summary-list govuk-!-margin-bottom-2">
      <% @legal_aid_application.uploaded_evidence_by_category.each do | category, attachments| %>
      <%= check_answer_no_link(
            name: category,
            question: t(".evidence_types.#{category}"),
            answer: attachments,
            read_only:,
          ) %>
      <% end %>
    </dl>
  </section>
<% end %>
