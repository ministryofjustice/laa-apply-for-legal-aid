<%= page_template(page_title: t('.h1-heading')) do %>
  <% if Setting.allow_multiple_proceedings? %>
    <h2 class="govuk-heading-l">
      <%= t('.proceedings_heading') %>
    </h2>

    <dl class="govuk-summary-list govuk-!-padding-bottom-4">
      <%= render partial: 'providers/limitations/proceeding_type',
                 collection: @legal_aid_application.application_proceedings_by_name,
                 locals: {translation_path: 'providers.limitations.show'} %>
    </dl>

    <h2 class="govuk-heading-l">
      <%= t('.cost_heading') %>
    </h2>
    <p class="govuk-body">
      <% if @legal_aid_application.used_delegated_functions? %>
      <p><%= t('.emergency_certificate') %>: <strong><%= gds_number_to_currency(@legal_aid_application.default_delegated_functions_cost_limitation,  precision: 0) %></strong></p>
    <% end %>
    <div class="govuk-!-padding-bottom-1"></div>
    <p><%= t('.substantive_certificate') %>: <strong><%= gds_number_to_currency(@legal_aid_application.default_substantive_cost_limitation,  precision: 0) %></strong></p>
    </p>

    <!-- This entire else block can be removed when multiple proceedings goes live and the feature flag is removed -->
  <% else %>

    <h2 class="govuk-heading-m">
      <%= t('.proceedings_heading') %>
    </h2>
    <div class="selected-proceeding-types">
      <%= render partial: 'shared/forms/proceedings_types/proceeding_type', collection: @legal_aid_application.proceeding_types, locals: { translation_path: 'providers.limitations.show' } %>
    </div>

    <!--  References to delegated functions can be accessed off any application proceeding type -->
    <% application_proceeding_type = @legal_aid_application.application_proceeding_types.first %>
    <!--  TODO remove 'if' statement below once backend references delegated functions -->
    <!--  solely from the application proceeding types. -->
    <% if  @legal_aid_application.used_delegated_functions? %>
      <p class="govuk-body">
      <div class="govuk-heading-m"><%= t('.if_delegated_used') %></div>
      <p><strong><%= t('.form_of_service') %></strong> <%= @legal_aid_application.lead_proceeding_type.default_level_of_service.name %></p>
      <div class="govuk-!-padding-bottom-1"></div>
      <p><strong><%= t('.incurrable_costs') %></strong><%= gds_number_to_currency(@legal_aid_application.default_delegated_functions_cost_limitation,  precision: 0) %></p>
      <p><strong><%= t('.allowable_work') %></strong><%= application_proceeding_type.delegated_functions_scope_limitation.description %></p>
      </p>
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full text-column">
          <hr class="govuk-section-break govuk-section-break--visible govuk-!-padding-top-1 govuk-!-padding-bottom-1">
        </div>
      </div>
    <% end %>

    <p class="govuk-body">
    <div class="govuk-heading-m"><%= t('.substantive_certificate_covered') %></div>
    <p><strong><%= t('.form_of_service') %></strong><%= @legal_aid_application.lead_proceeding_type.default_level_of_service.name %></p>
    <div class="govuk-!-padding-bottom-1"></div>
    <p><strong><%= t('.incurrable_costs') %></strong><%= gds_number_to_currency(@legal_aid_application.default_substantive_cost_limitation,  precision: 0) %></p>
    <p><strong><%= t('.allowable_work') %></strong><%= application_proceeding_type.substantive_scope_limitation.description %></p>
    </p>

  <% end %>

  <div class="govuk-!-padding-bottom-6"></div>

  <%= next_action_buttons_with_form(
        url: providers_legal_aid_application_limitations_path,
        method: :patch,
        show_draft: true
      ) %>
<% end %>
