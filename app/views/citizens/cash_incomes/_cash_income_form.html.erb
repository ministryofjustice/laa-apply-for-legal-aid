<%= form_with(
      builder: GOVUKDesignSystemFormBuilder::FormBuilder,
      model: @aggregated_cash_income,
      url: form_path,
      method: :patch,
      local: true
    ) do |form| %>

  <%#= govuk_form_group show_error_if: @aggregated_cash_income.errors.include?(:none_selected) do %>

    <%= form.govuk_check_boxes_fieldset '',
                                        legend: {size: 'xl', tag: 'h1', text: page_title} do %>
      <p><%= t('.info') %></p>
      <span id="select-all-that-apply-hint" class="govuk-hint"><%= t('generic.select_all_that_apply') %></span>

        <div class="deselect-group" data-deselect-ctrl="#aggregated-cash-income-none-selected-true-field">
          <% @legal_aid_application.transaction_types.not_children.credits.each do |transaction_type| %>
            <%= render(
                  'shared/partials/revealing_checkbox',
                  name: transaction_type.name,
                  form: form,
                  number_of_fields: AggregatedCashIncome::NUMBER_OF_FIELDS,
                  model: @aggregated_cash_income,
                  input_prefix: t('currency.gbp')
                ) %>
          <% end %>
        </div>

        <%= form.govuk_radio_divider %>
        <%= form.govuk_check_box :none_selected, true, @aggregated_cash_income.none_selected, multiple: false, link_errors: true,
                                 label: {text: t('generic.none_selected')} %>
    <% end %>

  <div class="govuk-!-padding-bottom-4"></div>

  <%= next_action_buttons(
        form: form,
        show_draft: false
      ) %>
<% end %>
